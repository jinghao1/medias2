<!DOCTYPE html>
<html lang="en">
<head>
<!-- <base href="__PUBLIC__/"> -->
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />  
	<title>立即报名</title>
   <!-- <script type="text/javascript" src="./web/js/jquery-3.0.0.js"></script>-->
    <script type="text/javascript" src="./web/js/login.js"></script> 
	<style>
		input,select{border:none; background: none;padding-left:10px;}
		ul,li{list-style: none}
		.login{width:400px; overflow:hidden;margin:50px auto;background:#7d6c65;border-radius: 4px; padding:30px 0;}
		.login ul{float:left;}
		.login ul li{width:220px;float:left;margin-left:55px;}
		.login ul li input{width:208px;height:38px;line-height:38px\9;border:1px solid #ccc;border-radius: 4px;float:left;margin-bottom:8px;}
		/*.login ul li input{height:40px;}*/
		.login ul li input.name{width:92px;}
		.login ul li .province,.login ul li .city,.login ul li .sex{height:40px;border:1px solid #ccc;border-radius: 4px;float:left;margin-bottom:8px;width:103px;}
		.login ul li .province select,.login ul li .city select,.login ul li .sex select{width:103px;/*padding:11px 0px 11px 10px;*/height:40px;}
		.login ul li .city,.login ul li .sex{margin-left:10px;}
		.login ul li .dealer,.login ul li .carType{height:40px;border:1px solid #ccc;border-radius: 4px;float:left;margin-bottom:8px;width:218px;}
		.login ul li .dealer select,.login ul li .carType select{width:218px;/*padding:11px 0px 11px 10px;*/height:40px;}
		.btn{cursor:pointer;width:220px; background: #8d3319;float:left;line-height: 46px;border-radius: 6px; text-align: center;color:#fff;margin-left:95px;}
	</style>
</head>
<body>
	<div class="login">
		<ul>
			<!-- 姓名/性别 -->
			<li>
				<input type="text"  value="姓名" class="name" name="name"><span></span>
				<div class="sex">
					<select id="sex" name="sexId"><option>请选择性别</option><option value="1">男</option><option value="2">女</option></select>
				</div>
			</li>
			<!-- 手机号 -->
			<li><input type="text"  value="手机号" name="phone"><span></span></li>
			<!-- 省市 -->
			<li>
				<div class="province">
					<select id="province" name="provinceId" ><option>省份</option></select>
				</div>
				<div class="city">
					<select id="city" name="cityId"><option>城市</option></select>
				</div>
			</li>
			<!-- 经销商 -->
			<li>
				<div class="dealer">
					<select id="dealer" name='dealer'><option>经销商</option></select>
				</div>
			</li>
			<!-- 意向车型 -->
			<li>
				<div class="carType">
					<select id="carType" name='car_series_id'>
						<option value="61">东风标致4008</option>
						<option value="62">东风标致3008</option>
						<option value="63">东风标致2008</option>
					</select>
				</div>
			</li>
		</ul>
		<div class="btn">意向车型</div>
		<div id="newsongend"></div>
	</div>	
</body>
</html>
<script type="text/javascript">
$(document).ready(function(){
	var encrystr = $("input[name='encrystr']").val();
	$(".btn").click(function(){
		//名字不为空
	 	var name = $("input[name='name']").val();
	 	if(name == "" || name == "姓名" ){
	 		alert("请输入姓名");
	 		$("input[name='name']").focus();
	 		return false;
	 	}
	 	if (!name.match(/^([\u4E00-\u9FA5]{2,4}$)|(^[a-zA-Z]{1,8}$)/)){ 
			alert("抱歉，姓名需要输入2-4位汉字或八个英文字母");
			return false;
		}
	 	//性别，必选
	 	var sex = $("select[name='sexId']").val(); 
	 	//alert(sex); 
	 	if(sex == "请选择性别"){
	 		alert("请选择性别");
	 		$("select[name='sexId']").focus();
	 		return false; 
	 	}
	 	//手机号验证
	 	var phone = $("input[name='phone']").val();
	 	if (phone == "" || phone == "手机号") { 
	 		alert("手机号码不能为空！");  
	 		$("input[name='phone']").focus(); 
	 		return false; 
	 	}  
	 	if (!phone.match(/^(((1[3|5|7|8][0-9]{1}))+\d{8})$/)) { 
	 		alert("手机号码格式不正确！");  
	 		$("input[name='phone']").focus(); 
	 		return false; 
	 	}
	  

	 	//省，必选
	 	var province = $("select[name='provinceId']").val();
	 	//console.log(province);
	 	if(province == "省份"){
	 		alert("请选择省份");
	 		$("select[name='provinceId']").focus();
	 		return false; 
	 	}
	 	//市，必选
	 	var city = $("select[name='cityId']").val(); 
	 	if(city == "城市"){
	 		alert("请选择城市");
	 		$("select[name='cityId']").focus();
	 		return false; 
	 	}
	 	//经销商，必选
	 	var dealer = $("select[name='dealer']").val(); 
	 	if(dealer == "经销商"){
	 		alert("请选择经销商");
	 		$("select[name='dealer']").focus();
	 		return false; 
	 	}
	 	//车系必选
	 	var carid = $("select[name='car_series_id']").val();
	 	if(carid == "意向车型"){
	 		alert("请选择车型");
	 		$("select[name='car_series_id[]']").focus();
			return false; 
	 	}
	 	var dealer_name = province+","+city+","+dealer;
	 	//
	 	$.ajax({
		  	type: 'POST',
		  	url: 'http://fld.xingyuanauto.com/public/index.php/port/Userdblotter/DuserBphone',
		  	data: {numberphone:phone,key:encrystr},
		  	dataType: "json",
		    success: function(data){  //验证下游是否有注册,
			    if(data.start=="2008"){
				    $.getJSON("http://h5.qlh520.top/media/public/index.php/port/Userreg/Comreg", { han: "dealreg",username:name,thesex:sex,numberphone:phone,dealer:dealer_name,model:carid,key:encrystr}, function(json){ 
						if(jQuery.type(json)=="string"){
							var json = eval('('+json+')'); //字符串转为json格式
						} 
						alert(json.msg);
						console.log(json);
						 
					})
			    }else{
				    alert(data.msg);
				    console.log(data);
			    } 
			},
			error:function(err){
				alert("注册人数较多，请稍后");
			} 
		}); 
	})




	var url = "http://h5.qlh520.top/weixin/jssdk/wx_token.php";
	$.post(url,function(msg){
		if(msg.start == 0){ 
          return alert(msg.message);
        }
		
			var title ='东风标致购车节'; // 分享标题
            var link ='http://h5.qlh520.top/media/201703/peugeot';
            var desc = '标致4008全新上市'; // 分享描述
            var imgUrl = 'http://h5.qlh520.top/invitation/img/log1.png';
		
		    var wx_appId = msg.appId; 
			var wx_timestamp = msg.timestamp;
			var wx_nonceStr = msg.nonceStr;
			var wx_signature = msg.signature;
		
		        /*
             * 注意：
             * 1. 所有的JS接口只能在公众号绑定的域名下调用，公众号开发者需要先登录微信公众平台进入“公众号设置”的“功能设置”里填写“JS接口安全域名”。
             * 2. 如果发现在 Android 不能分享自定义内容，请到官网下载最新的包覆盖安装，Android 自定义分享接口需升级至 6.0.2.58 版本及以上。
             * 3. 常见问题及完整 JS-SDK 文档地址：http://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html
             *
             * 开发中遇到问题详见文档“附录5-常见错误及解决办法”解决，如仍未能解决可通过以下渠道反馈：
             * 邮箱地址：weixin-open@qq.com
             * 邮件主题：【微信JS-SDK反馈】具体问题
             * 邮件内容说明：用简明的语言描述问题所在，并交代清楚遇到该问题的场景，可附上截屏图片，微信团队会尽快处理你的反馈。
             */
            wx.config({
                debug: false,
                appId: wx_appId,
                timestamp: wx_timestamp,
                nonceStr: wx_nonceStr,
                signature: wx_signature,
                jsApiList: [
                    // 所有要调用的 API 都要加到这个列表中
                    'onMenuShareTimeline',//分享到朋友圈
                    'onMenuShareAppMessage',//分享给朋友
                    'onMenuShareQQ',//分享到QQ
					'onMenuShareQZone',//分享到QQ空间
                    'onMenuShareWeibo'//分享到腾讯微博
                ]
            });
           
		   wx.ready(function () {
                // 在这里调用 API
				
				//分享到朋友圈
                wx.onMenuShareTimeline({
                    title:title, // 分享标题
                    link: link, // 分享链接
                    desc: desc, // 分享描述
                    imgUrl:imgUrl, // 分享图标
                    success: function () {
                        // 用户确认分享后执行的回调函数
                    },
                    cancel: function () {
                        // 用户取消分享后执行的回调函数
                    }
                });
				
				//分享到朋友
				wx.onMenuShareAppMessage({
                    title: title, // 分享标题
                    desc: desc, // 分享描述
                    link: link, // 分享链接
                    imgUrl: imgUrl, // 分享图标
                    type: '', // 分享类型,music、video或link，不填默认为link
                    dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
                    success: function () {
                        // 用户确认分享后执行的回调函数
                    },
                    cancel: function () {
                        // 用户取消分享后执行的回调函数
                    }
                });
				
                //分享到QQ
				wx.onMenuShareQQ({
                    title: title, // 分享标题
                    desc: desc, // 分享描述
                    link: link, // 分享链接
                    imgUrl: imgUrl, // 分享图标
                    success: function () {
                        // 用户确认分享后执行的回调函数
                    },
                    cancel: function () {
                        // 用户取消分享后执行的回调函数
                    }
                });
				
				//分享到QQ空间
				wx.onMenuShareQZone({
					title: title, // 分享标题
					desc: desc, // 分享描述
					link: link, // 分享链接
					imgUrl: imgUrl, // 分享图标
					success: function () { 
					   // 用户确认分享后执行的回调函数
					},
					cancel: function () { 
						// 用户取消分享后执行的回调函数
					}
				});
				
				//分享到腾讯微博
                wx.onMenuShareWeibo({
                    title: title, // 分享标题
                    desc: desc, // 分享描述
                    link: link, // 分享链接
                    imgUrl: imgUrl, // 分享图标
                    success: function () {
                        // 用户确认分享后执行的回调函数
                    },
                    cancel: function () {
                        // 用户取消分享后执行的回调函数
                    }
                });

            });
			
	},'json')
});
</script>